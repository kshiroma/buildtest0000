version: 0.2

            
phases:
  build:
    commands:
      - rm -rf config
      - rm -rf external-resources/product
      - git config --global credential.helper '!aws codecommit credential-helper $@'
      - git config --global credential.UseHttpPath true
      - git clone https://git-codecommit.ap-northeast-1.amazonaws.com/v1/repos/cattleya_test000 config --depth 1
      - mv config/product external-resources/product
      - rm -rf config
      - mvn package

  post_build:
    commands:
      - export DIRECTORY=`date +%Y/%m/%d`
      - mkdir $DIRECTORY -p
      - cp target/excelconverter-1.0.jar $DIRECTORY/excelconverter-1.0.jar
      - cp target/excelconverter-1.0.jar excelconverter-1.0.jar
  uplad_artifacts:
    commands:
      - aws s3 cp excelconverter-1.0.jar s3://shiromakenji-first-test/product/latest/excelconverter-1.0.jar
      - aws s3 cp excelconverter-1.0.jar s3://shiromakenji-first-test/product/$DIRECTORY/$CODEBUILD_BUILD_ID/excelconverter-1.0.jar
artifacts:
  files:
     - $DIRECTORY/excelconverter-1.0.jar
#    - excelconverter-1.0.jar

